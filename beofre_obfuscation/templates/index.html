<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi-Stack | Host Node.js</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-papHh5fZ4jU4rF5c3IGPLeuQH6pLgKZ6p7kn2APO+nX8J+7xVf3b+fZ+k5tZoJ5TZefp4XUQm52A6xmB5PBiIg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="icon" href="{{ url_for('static', filename='fav.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='index_style.css') }}">
</head>
<body class="{% if not current_user.is_authenticated %}guest-mode{% endif %}">
  <header class="{% if current_user.is_authenticated %}logged-in{% endif %}">
    <h1>
      ðŸš€ 
      {% if current_user.is_authenticated %}
        Mi-<span style="color: rgba(255, 0, 0, 0.637);">Stack</span>
      {% else %}
        Mi-Stack
      {% endif %}
    </h1>
    <p>Host your Node.js app with ZIP or GitHub â€” Free & Fast</p>
    <div class="auth-links">
      {% if current_user.is_authenticated %}
        <span style="color:white; font-weight:600;">ðŸ›¸ {{ current_user.email.split('@')[0] }}</span>
        <a href="{{ url_for('logout') }}">Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}">Login</a>
        <a href="{{ url_for('register') }}">Register</a>
      {% endif %}
    </div>
  </header>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-container">
        {% for category, msg in messages %}
          <div class="flash {{ category }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <main id="mainContent">
    {% if current_user.is_authenticated %}
    <div class="container">
      <h2>Deploy a New App</h2>
      <form action="{{ url_for('upload_zip') }}" method="POST" enctype="multipart/form-data">
        <label>Upload a ZIP file:</label>
        <input type="file" name="site_zip" accept=".zip" />

        <label>Or enter GitHub repo HTTPS URL:</label>
        <input type="text" name="github_url" placeholder="https://github.com/username/repo" />

        <input type="submit" value="Upload & Host" onclick="showUploadSpinner()">
        <div class="upload-spinner" id="uploadSpinner"></div>
      </form>

      <h2>Your Running Apps</h2>
      <table id="apps-table">
        <thead>
          <tr>
            <th>App ID</th>
            <th>URL</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    {% endif %}
  </main>

  <!-- Modal container -->
  <div id="dynamicContent"></div>


  <script type="text/template" id="modalTemplate">
    <div class="modal-bg" id="modalBg">
      <div class="modal" id="modalContent"></div>
    </div>
  </script>

  <script type="text/template" id="guestIconsTemplate">
    <div class="container">
      <h2>Welcome to Mi-Stack</h2>
      <div class="icon-row">
        <img src="https://cdn-icons-png.flaticon.com/512/1055/1055710.png"
             title="How it works" onclick="openModal('how')"/>
        <img src="https://cdn-icons-png.flaticon.com/512/2910/2910797.png"
             title="ZIP example" onclick="openModal('zip')"/>
        <img src="https://cdn-icons-png.flaticon.com/512/1995/1995522.png"
             title="About us" onclick="openModal('about')"/>
      </div>
      <p>Please <a href="{{ url_for('login') }}">login</a> or <a href="{{ url_for('register') }}">register</a> to start hosting your apps.</p>
    </div>
  </script>

  <!-- External JS -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" defer></script>
<script src="https://unpkg.com/split-type" defer></script>
<script src="{{ url_for('static', filename='main.js') }}" defer></script>

<!-- Replace this line -->
<!-- <script src="{{ url_for('static', filename='inject.js') }}" defer></script> -->

<!-- With this line for module support -->
<script type="module" src="{{ url_for('static', filename='inject.js') }}"></script>

</body>

</html>

